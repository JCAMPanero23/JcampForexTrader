<Window x:Class="JcampForexTrader.ChartViewerWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:scottplot="clr-namespace:ScottPlot.WPF;assembly=ScottPlot.WPF"
        Title="MT5-Style Chart Viewer - JCAMP Backtesting"
        Height="900" Width="1600"
        WindowStartupLocation="CenterScreen"
        Background="#000000"
        Foreground="White">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Top Control Bar -->
        <Border Grid.Row="0" Background="#1E1E1E" BorderBrush="#3E3E42" BorderThickness="0,0,0,1" Padding="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Symbol/Period Info -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock x:Name="SymbolText" Text="EURUSD" FontSize="18" FontWeight="Bold" Margin="0,0,15,0"/>
                    <TextBlock x:Name="PeriodText" Text="2024-11-01 to 2024-11-30" FontSize="14" Foreground="#CCCCCC" VerticalAlignment="Center"/>
                </StackPanel>

                <!-- Playback Controls -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <Button x:Name="PlayPauseButton" Content="Play" Width="80" Height="35" Margin="5"
                            Background="#007ACC" Foreground="White" BorderBrush="#007ACC" FontSize="14"
                            Click="PlayPauseButton_Click"/>

                    <TextBlock Text="Speed:" VerticalAlignment="Center" Margin="15,0,5,0" FontSize="14"/>
                    <Slider x:Name="SpeedSlider" Width="200" Minimum="0.5" Maximum="50" Value="5"
                            VerticalAlignment="Center" Margin="5,0"
                            TickFrequency="0.5" IsSnapToTickEnabled="True"
                            ValueChanged="SpeedSlider_ValueChanged"/>
                    <TextBlock x:Name="SpeedText" Text="5x (5.0 bars/sec)" Width="120" VerticalAlignment="Center" Margin="5,0,15,0" FontSize="14"/>

                    <Button x:Name="ResetButton" Content="Reset" Width="80" Height="35" Margin="5" FontSize="14"
                            Background="#2D2D30" Foreground="White" BorderBrush="#3E3E42"
                            Click="ResetButton_Click"/>
                </StackPanel>

                <!-- Action Buttons -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button x:Name="OpenHtmlChartsButton" Content="Open HTML Charts" Width="140" Height="35" Margin="5" FontSize="13"
                            Background="#2D2D30" Foreground="White" BorderBrush="#3E3E42"
                            Click="OpenHtmlChartsButton_Click"/>
                    <Button x:Name="CloseButton" Content="Close" Width="80" Height="35" Margin="5" FontSize="14"
                            Background="#2D2D30" Foreground="White" BorderBrush="#3E3E42"
                            Click="CloseButton_Click"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content Area: Chart + Right Panel -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*"/>
                <ColumnDefinition Width="1*"/>
            </Grid.ColumnDefinitions>

            <!-- Left: Chart Area -->
            <scottplot:WpfPlot x:Name="ChartPlot" Grid.Column="0" Background="#000000"/>

            <!-- Right: Trade Details Panel (3-Tab Layout) -->
            <Border Grid.Column="1" Background="#1E1E1E" BorderBrush="#3E3E42" BorderThickness="1,0,0,0">
                <TabControl Background="#1E1E1E" BorderThickness="0" Padding="0">

                    <!-- Tab 1: Active Trades -->
                    <TabItem Header="Active Trades" Background="#2D2D30" Foreground="White" FontSize="13">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel Margin="10">
                                <!-- Performance Summary -->
                                <TextBlock Text="Performance Summary" FontSize="16" FontWeight="Bold" Margin="0,0,0,10" Foreground="White"/>

                                <Grid Margin="0,0,0,15">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="Wins:" FontSize="12" Foreground="#888888"/>
                                        <TextBlock x:Name="WinsCountText" Text="0" FontSize="18" FontWeight="Bold" Foreground="#00AA00"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="1">
                                        <TextBlock Text="Losses:" FontSize="12" Foreground="#888888"/>
                                        <TextBlock x:Name="LossesCountText" Text="0" FontSize="18" FontWeight="Bold" Foreground="#FF4444"/>
                                    </StackPanel>
                                </Grid>

                                <Grid Margin="0,0,0,15">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="Total R:" FontSize="12" Foreground="#888888"/>
                                        <TextBlock x:Name="TotalRText" Text="0.00R" FontSize="18" FontWeight="Bold" Foreground="White"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="1">
                                        <TextBlock Text="Win Rate:" FontSize="12" Foreground="#888888"/>
                                        <TextBlock x:Name="WinRateText" Text="0%" FontSize="18" FontWeight="Bold" Foreground="White"/>
                                    </StackPanel>
                                </Grid>

                                <Separator Background="#3E3E42" Margin="0,5,0,15"/>

                                <!-- Active Trade Slots (5) -->
                                <TextBlock Text="Open Positions" FontSize="14" FontWeight="Bold" Margin="0,0,0,10" Foreground="White"/>

                                <Border x:Name="ActiveTrade1Border" Background="#2D2D30" BorderBrush="#3E3E42" BorderThickness="1" Padding="8" Margin="0,0,0,5"
                                        MouseDown="PositionSlot_Click" Cursor="Arrow">
                                    <TextBlock x:Name="ActiveTrade1Text" Text="[Empty]" FontSize="11" Foreground="#888888" TextWrapping="Wrap"/>
                                </Border>

                                <Border x:Name="ActiveTrade2Border" Background="#2D2D30" BorderBrush="#3E3E42" BorderThickness="1" Padding="8" Margin="0,0,0,5"
                                        MouseDown="PositionSlot_Click" Cursor="Arrow">
                                    <TextBlock x:Name="ActiveTrade2Text" Text="[Empty]" FontSize="11" Foreground="#888888" TextWrapping="Wrap"/>
                                </Border>

                                <Border x:Name="ActiveTrade3Border" Background="#2D2D30" BorderBrush="#3E3E42" BorderThickness="1" Padding="8" Margin="0,0,0,5"
                                        MouseDown="PositionSlot_Click" Cursor="Arrow">
                                    <TextBlock x:Name="ActiveTrade3Text" Text="[Empty]" FontSize="11" Foreground="#888888" TextWrapping="Wrap"/>
                                </Border>

                                <Border x:Name="ActiveTrade4Border" Background="#2D2D30" BorderBrush="#3E3E42" BorderThickness="1" Padding="8" Margin="0,0,0,5"
                                        MouseDown="PositionSlot_Click" Cursor="Arrow">
                                    <TextBlock x:Name="ActiveTrade4Text" Text="[Empty]" FontSize="11" Foreground="#888888" TextWrapping="Wrap"/>
                                </Border>

                                <Border x:Name="ActiveTrade5Border" Background="#2D2D30" BorderBrush="#3E3E42" BorderThickness="1" Padding="8" Margin="0,0,0,5"
                                        MouseDown="PositionSlot_Click" Cursor="Arrow">
                                    <TextBlock x:Name="ActiveTrade5Text" Text="[Empty]" FontSize="11" Foreground="#888888" TextWrapping="Wrap"/>
                                </Border>
                            </StackPanel>
                        </ScrollViewer>
                    </TabItem>

                    <!-- Tab 2: Indicators -->
                    <TabItem Header="Indicators" Background="#2D2D30" Foreground="White" FontSize="13">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel Margin="10">
                                <!-- EMA Overlay Selector -->
                                <TextBlock Text="EMA Overlays" FontSize="14" FontWeight="Bold" Margin="0,0,0,5" Foreground="White"/>
                                <StackPanel Orientation="Vertical" Margin="0,0,0,15">
                                    <CheckBox x:Name="M15EmaCheckbox" Content="M15 EMAs (Solid)" IsChecked="True"
                                             Foreground="White" Margin="0,0,0,5" FontSize="13"
                                             Checked="EmaVisibility_Changed" Unchecked="EmaVisibility_Changed"/>
                                    <CheckBox x:Name="H1EmaCheckbox" Content="H1 EMAs (Dashed)" IsChecked="False"
                                             Foreground="White" FontSize="13"
                                             Checked="EmaVisibility_Changed" Unchecked="EmaVisibility_Changed"/>
                                </StackPanel>

                                <Separator Background="#3E3E42" Margin="0,5,0,15"/>

                                <!-- Market Regime -->
                                <TextBlock Text="Market Regime" FontSize="14" FontWeight="Bold" Margin="0,0,0,10" Foreground="White"/>
                                <StackPanel Margin="0,0,0,15">
                                    <TextBlock Text="Current Regime:" FontSize="12" Foreground="#888888"/>
                                    <TextBlock x:Name="RegimeText" Text="N/A" FontSize="16" FontWeight="Bold" Foreground="#007ACC"/>
                                </StackPanel>

                                <Separator Background="#3E3E42" Margin="0,5,0,15"/>

                                <!-- Technical Indicators -->
                                <TextBlock Text="Technical Indicators" FontSize="14" FontWeight="Bold" Margin="0,0,0,10" Foreground="White"/>

                                <StackPanel Margin="0,0,0,10">
                                    <TextBlock Text="EMA Alignment:" FontSize="12" Foreground="#888888"/>
                                    <TextBlock x:Name="EmaAlignmentText" Text="N/A" FontSize="13" Foreground="White"/>
                                </StackPanel>

                                <StackPanel Margin="0,0,0,10">
                                    <TextBlock Text="CSM Differential:" FontSize="12" Foreground="#888888"/>
                                    <TextBlock x:Name="CsmDiffText" Text="N/A" FontSize="13" Foreground="White"/>
                                </StackPanel>

                                <StackPanel Margin="0,0,0,10">
                                    <TextBlock Text="RSI (14):" FontSize="12" Foreground="#888888"/>
                                    <TextBlock x:Name="RsiText" Text="N/A" FontSize="13" Foreground="White"/>
                                </StackPanel>

                                <StackPanel Margin="0,0,0,10">
                                    <TextBlock Text="ADX (14):" FontSize="12" Foreground="#888888"/>
                                    <TextBlock x:Name="AdxText" Text="N/A" FontSize="13" Foreground="White"/>
                                </StackPanel>

                                <StackPanel>
                                    <TextBlock Text="Current Price:" FontSize="12" Foreground="#888888"/>
                                    <TextBlock x:Name="CurrentPriceText" Text="N/A" FontSize="16" FontWeight="Bold" Foreground="White"/>
                                </StackPanel>
                            </StackPanel>
                        </ScrollViewer>
                    </TabItem>

                    <!-- Tab 3: Recent Trades -->
                    <TabItem Header="Recent Trades" Background="#2D2D30" Foreground="White" FontSize="13">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel Margin="10">
                                <!-- Jump to Trade Option -->
                                <CheckBox x:Name="JumpToTradeCheckbox" Content="Jump to selected trade on chart"
                                         IsChecked="True" Foreground="White" FontSize="12" Margin="0,0,0,10"/>

                                <Separator Background="#3E3E42" Margin="0,0,0,10"/>

                                <!-- Trade List -->
                                <TextBlock Text="Closed Trades" FontSize="14" FontWeight="Bold" Margin="0,0,0,10" Foreground="White"/>

                                <ListView x:Name="RecentTradesListView"
                                         SelectionMode="Single"
                                         Background="#1E1E1E"
                                         BorderBrush="#3E3E42"
                                         Foreground="White"
                                         Height="300"
                                         SelectionChanged="RecentTradeSelected">
                                    <ListView.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding CompactDisplay}"
                                                      Foreground="{Binding TextColor}"
                                                      FontSize="11"
                                                      Padding="5"/>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                </ListView>

                                <Separator Background="#3E3E42" Margin="0,10,0,10"/>

                                <!-- Trade Details Panel -->
                                <Border x:Name="TradeDetailsPanel"
                                       Background="#2D2D30"
                                       BorderBrush="#3E3E42"
                                       BorderThickness="1"
                                       Padding="10"
                                       Visibility="Collapsed">
                                    <StackPanel>
                                        <TextBlock Text="Trade Details" FontSize="14" FontWeight="Bold" Foreground="White" Margin="0,0,0,10"/>
                                        <TextBlock x:Name="TradeDetailsText"
                                                  Text="Select a trade to view details"
                                                  FontSize="11"
                                                  Foreground="#CCCCCC"
                                                  TextWrapping="Wrap"/>
                                    </StackPanel>
                                </Border>
                            </StackPanel>
                        </ScrollViewer>
                    </TabItem>

                </TabControl>
            </Border>
        </Grid>

        <!-- Bottom Panel: Playback Slider + Trade Timeline + Pair Tabs + Date/Time -->
        <Border Grid.Row="2" Background="#1E1E1E" BorderBrush="#3E3E42" BorderThickness="0,1,0,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Progress Slider Row -->
                <Grid Grid.Row="0" Margin="10,5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" x:Name="ProgressText" Text="Bar: 0 / 0"
                              VerticalAlignment="Center" Margin="0,0,10,0" FontSize="12"/>

                    <Slider Grid.Column="1" x:Name="ProgressSlider"
                           Minimum="0" Maximum="100" Value="0"
                           VerticalAlignment="Center"
                           ValueChanged="ProgressSlider_ValueChanged"/>

                    <TextBlock Grid.Column="2" x:Name="ProgressPercent" Text="0%"
                              VerticalAlignment="Center" Margin="10,0,20,0" FontSize="12"/>

                    <StackPanel Grid.Column="3" Orientation="Horizontal">
                        <TextBlock x:Name="CurrentTimeText" Text="18 Nov 2025  09:00" FontSize="12" Foreground="White" Margin="0,0,15,0" VerticalAlignment="Center"/>
                        <TextBlock Text="Active: " FontSize="12" Foreground="#888888" VerticalAlignment="Center"/>
                        <TextBlock x:Name="ActiveTradesText" Text="1" FontSize="12" Foreground="White" Margin="0,0,0,0" VerticalAlignment="Center"/>
                    </StackPanel>
                </Grid>

                <!-- Trade Timeline Row -->
                <Border Grid.Row="1" Background="#0E0E0E" Margin="10,5,10,5" BorderBrush="#3E3E42" BorderThickness="1" Height="60">
                    <Canvas x:Name="TradeTimelineCanvas" Background="Transparent"
                            MouseLeftButtonDown="TradeTimelineCanvas_Click"
                            SizeChanged="TradeTimelineCanvas_SizeChanged"/>
                </Border>

                <!-- Pair Tabs Row (Dynamically generated in code-behind) -->
                <TabControl x:Name="PairTabControl" Grid.Row="2"
                            Background="#1E1E1E"
                            BorderThickness="0"
                            Padding="5,0"
                            SelectionChanged="PairTabControl_SelectionChanged">
                    <!-- Tabs will be added dynamically via GeneratePairTabs() -->
                </TabControl>
            </Grid>
        </Border>
    </Grid>
</Window>
